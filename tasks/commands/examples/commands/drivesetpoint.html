

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Driving a Distance Forward &mdash; Team 6624&#39;s Software Guide 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="Team 6624&#39;s Software Guide 1.0 documentation" href="../../../../index.html"/>
        <link rel="up" title="Examples of Commands" href="../commandexamples.html"/>
        <link rel="next" title="Rotating a Claw both Manually and using Setpoints" href="aimclaw.html"/>
        <link rel="prev" title="Moving an Elevator Manually" href="elevatormanual.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> Team 6624's Software Guide
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../robotcode/robotcode.html">Robot Code</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../tasks.html">Common Tasks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../newproject.html">Creating a new project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../drivetrains/drivetrains.html">Drive Trains</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../drivercontrols.html">Switching around Driver Controls in OI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../integration.html">Integrating code</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../commands.html">Creating a Command</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../commandexamples.html">Examples of Commands</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="climber.html">Climber</a></li>
<li class="toctree-l4"><a class="reference internal" href="tankdrive.html">Tank Drive</a></li>
<li class="toctree-l4"><a class="reference internal" href="bacq.html">Ball Acquisition</a></li>
<li class="toctree-l4"><a class="reference internal" href="claw.html">Open and Close a Claw</a></li>
<li class="toctree-l4"><a class="reference internal" href="elevatormanual.html">Moving an Elevator Manually</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Driving a Distance Forward</a></li>
<li class="toctree-l4"><a class="reference internal" href="aimclaw.html">Rotating a Claw both Manually and using Setpoints</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../commandgroups.html">Creating a Command Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../subsystems/subsystems.html">Creating a Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autonomous/autonomous.html">Autonomous Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../camera/camera.html">Camera</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../github/github.html">GitHub</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Team 6624's Software Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../tasks.html">Common Tasks</a> &raquo;</li>
        
          <li><a href="../../commands.html">Creating a Command</a> &raquo;</li>
        
          <li><a href="../commandexamples.html">Examples of Commands</a> &raquo;</li>
        
      <li>Driving a Distance Forward</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="driving-a-distance-forward">
<h1>Driving a Distance Forward<a class="headerlink" href="#driving-a-distance-forward" title="Permalink to this headline">¶</a></h1>
<p>This example talks about how to use a PID Controller and Encoders to make the robot accurately drive a certain distance forward.</p>
<p>Note that this guide assumes that you understand how to use <a class="reference external" href="./../../../../robotcode/components/pid/pidcontroller1.html">PIDControllers</a>, as well as <a class="reference external" href="./../../../../robotcode/components/pid/pidsource.html">PIDSources</a> and <a class="reference external" href="./../../../../robotcode/components/pid/pidoutput.html">PIDOutputs</a>.</p>
<div class="section" id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<p>The design of this drive is simply a normal tank drive. There are three motors on the left, and three motors on the right, and every motor has its own speed controller. Additionally, there is one encoder per side of the robot.</p>
</div>
<div class="section" id="subsystem-methods">
<h2>Subsystem methods<a class="headerlink" href="#subsystem-methods" title="Permalink to this headline">¶</a></h2>
<p>This guide assumes that there already is a Drive subsystem, with PIDOutputs that group together the motors. In this example, we mainly care about the ALL_MOTORS group, that, when written to, sets all of the drive motors to the same value. If this is confusing, see <a class="reference external" href="./../../../../robotcode/components/pid/pidoutput.html">PIDOutputs</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_ALL_MOTORS</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mf">1.0</span><span class="o">);</span> <span class="c1">// sets all motors to full power forward</span>
</pre></div>
</div>
<p>Additionally, there is already a PIDSource that groups together the drive encoders, by taking the average of the left and right drive encoders. If this is confusing, see <a class="reference external" href="./../../../../robotcode/components/pid/pidsource.html">PIDSources</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_ENCODERS</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="c1">// get the average of the left and right encoders</span>
</pre></div>
</div>
<p>Lastly, there is a PID Controller that takes input from the encoders and outputs to the drive motors.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">DRIVE_DISTANCE_CONTROLLER</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PIDController</span><span class="o">(</span><span class="mf">0.015</span><span class="o">,</span> <span class="mf">0.0010</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">DRIVE_ENCODERS</span><span class="o">,</span> <span class="n">DRIVE_ALL_MOTORS</span><span class="o">);</span>
</pre></div>
</div>
<p>If this is confusing, see <a class="reference external" href="./../../../../robotcode/components/pid/pidcontroller1.html">PIDControllers</a>.</p>
<p>On how to create this subsystem, see <a class="reference external" href="./../../../subsystems/subsystems.html">Creating a subsystem</a>.</p>
</div>
<div class="section" id="writing-the-command">
<h2>Writing the command<a class="headerlink" href="#writing-the-command" title="Permalink to this headline">¶</a></h2>
<p>Once you create the DriveForwards command, you&#8217;ll get a blank command template like this:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">org.usfirst.frc.team93.robot.commands</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.command.Command</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DriveForwards</span> <span class="kd">extends</span> <span class="n">Command</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">DriveForwards</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Use requires() here to declare subsystem dependencies</span>
        <span class="c1">// eg. requires(chassis);</span>
    <span class="o">}</span>

    <span class="c1">// Called just before this Command runs the first time</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// Called repeatedly when this Command is scheduled to run</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// Make this return true when this Command no longer needs to run execute()</span>
    <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Called once after isFinished returns true</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">end</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// Called when another command which requires one or more of the same</span>
    <span class="c1">// subsystems is scheduled to run</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">interrupted</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In the javadoc at the top, describe what this command does.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * This command moves the robot a certain distance forwards.</span>
<span class="cm"> */</span>
</pre></div>
</div>
<p>Firstly, we have to pass in a distance that we want the robot to move. Then, we want to pass in a certain distance called a <em>maxError</em>. When the robot is within the maxError to the distance we want it to move, then command will end. This is necessary because the robot almost never truly reaches its target. It ends up just a little bit off, and the code needs to know how much accuracy is good enough, or else the command will never end, and it will stay at a fraction of an encoder tick off of the target forever.</p>
<p>Additionally, in the constructor, since this command runs on the drive, make sure this command requires the Drive subsystem.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">double</span> <span class="n">m_distance</span><span class="o">;</span>
<span class="kt">double</span> <span class="n">m_maxError</span><span class="o">;</span>

<span class="kd">public</span> <span class="nf">DriveForwards</span><span class="o">(</span><span class="kt">double</span> <span class="n">distance</span><span class="o">,</span> <span class="kt">double</span> <span class="n">maxError</span><span class="o">)</span>
<span class="o">{</span>
    <span class="n">m_distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">;</span>
    <span class="n">m_maxError</span> <span class="o">=</span> <span class="n">maxError</span><span class="o">;</span>

    <span class="c1">// Use requires() here to declare subsystem dependencies</span>
    <span class="n">requires</span><span class="o">(</span><span class="n">Robot</span><span class="o">.</span><span class="na">drive</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If Robot can&#8217;t be resolved, make sure to hover over the error and import Robot.</p>
<p>Then, when the command starts, we reset the encoders, reset the PID Controller, give the PID Controller a distance setpoint and a maxError, and then enable it.</p>
<p>We reset the encoders because if we want the robot to move 1000.0 ticks forward, if the encoders are already at a nonzero value, the robot will not move 1000.0 ticks. Thus, we want to reset the encoders back to 0.0.</p>
<p>We reset the PID Controller because we don&#8217;t want any previously accumulated I value to leak into this command run.</p>
<p>Giving the PID Controller a setpoint and a maxError, as well as enabling it, are self-explanatory.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Called just before this Command runs the first time</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span>
<span class="o">{</span>
    <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_ENCODERS</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
    <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
    <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">setSetpoint</span><span class="o">(</span><span class="n">m_distance</span><span class="o">);</span>
    <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">setAbsoluteTolerance</span><span class="o">(</span><span class="n">m_maxError</span><span class="o">);</span>
    <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now, since we&#8217;ve enabled the PID controller, the PID controller will now do all the work, instead of the command. Thus, the execute() method should actually be empty, so skip to the isFinished() method.</p>
<p>Now, the command should finish when the PID is within its error tolerance. We check this using the PIDController&#8217;s onTarget() method.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Make this return true when this Command no longer needs to run execute()</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="o">()</span>
<span class="o">{</span>
    <span class="c1">// end when the PID Controller is within its error tolerance</span>
    <span class="k">return</span> <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">onTarget</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>For safety purposes, when this command has to end(), it should stop the drive motors. interrupted() should do the same.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Called once after isFinished returns true</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">end</span><span class="o">()</span>
<span class="o">{</span>
    <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_ALL_MOTORS</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// Called when another command which requires one or more of the same</span>
<span class="c1">// subsystems is scheduled to run</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">interrupted</span><span class="o">()</span>
<span class="o">{</span>
    <span class="n">end</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="running-the-command">
<h2>Running the command<a class="headerlink" href="#running-the-command" title="Permalink to this headline">¶</a></h2>
<p>This command can be run in a multitude of ways. It can be placed in an autonomous plan, which is the most common usage, but it can be bound to a Joystick Button if the driver needs a way to back up straight, for example. There are many different ways to use a DriveForwards command, each with its own way of running it. See <a class="reference external" href="./../../commands.html#running-the-command">Running the command</a>.</p>
</div>
<div class="section" id="final-code">
<h2>Final code<a class="headerlink" href="#final-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">org.usfirst.frc.team93.robot.commands</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.usfirst.frc.team93.robot.Robot</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.usfirst.frc.team93.robot.subsystems.Drive</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.command.Command</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * This command moves the robot a certain distance forwards.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DriveForwards</span> <span class="kd">extends</span> <span class="n">Command</span>
<span class="o">{</span>
    <span class="kt">double</span> <span class="n">m_distance</span><span class="o">;</span>
    <span class="kt">double</span> <span class="n">m_maxError</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">DriveForwards</span><span class="o">(</span><span class="kt">double</span> <span class="n">distance</span><span class="o">,</span> <span class="kt">double</span> <span class="n">maxError</span><span class="o">)</span>
    <span class="o">{</span>
        <span class="n">m_distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">;</span>
        <span class="n">m_maxError</span> <span class="o">=</span> <span class="n">maxError</span><span class="o">;</span>

        <span class="c1">// Use requires() here to declare subsystem dependencies</span>
        <span class="n">requires</span><span class="o">(</span><span class="n">Robot</span><span class="o">.</span><span class="na">drive</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Called just before this Command runs the first time</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_ENCODERS</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
        <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
        <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">setSetpoint</span><span class="o">(</span><span class="n">m_distance</span><span class="o">);</span>
        <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">setAbsoluteTolerance</span><span class="o">(</span><span class="n">m_maxError</span><span class="o">);</span>
        <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">enable</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// Called repeatedly when this Command is scheduled to run</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span>
    <span class="o">{</span>
    <span class="o">}</span>

    <span class="c1">// Make this return true when this Command no longer needs to run execute()</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">isFinished</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_DISTANCE_CONTROLLER</span><span class="o">.</span><span class="na">onTarget</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// Called once after isFinished returns true</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">end</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">Drive</span><span class="o">.</span><span class="na">DRIVE_ALL_MOTORS</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// Called when another command which requires one or more of the same</span>
    <span class="c1">// subsystems is scheduled to run</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">interrupted</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="n">end</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="aimclaw.html" class="btn btn-neutral float-right" title="Rotating a Claw both Manually and using Setpoints" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="elevatormanual.html" class="btn btn-neutral" title="Moving an Elevator Manually" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>